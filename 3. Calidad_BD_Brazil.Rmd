---
title: "Informe de qualidade dos dados - Brasil"
output:
  html_document: default
  pdf_document: default
  word_document: default

---


```{r, echo = FALSE, warning = FALSE, message = FALSE}
# Librerías necesarias #
library(officer)
library(tidyverse)
library(tidyr) 
library(DataExplorer) 
library(readxl)
library(knitr)
library(sjPlot)       # Paquete para generar gráficos bonitos #
library(DT)
library(kableExtra)
library(flextable)
library(janitor)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}

# setwd: Fijar directorio de trabajo #


setwd("C:/Users/regin/OPAS/CONTRATO_2021/MS")

bd<- readRDS("eapv_25102021_covid19.Rds")

bd$not_semcovid = NULL

# nao mostrar os resultados na notacao cientifica
options(scipen = 999)


```




## Avaliação da qualidade dos dados notificados/investigação de Eventos Adversos Pós-Vacinação associados ao uso de Vacina, Soro ou Imunoglobulina



- Data do informe: 01 de dezembro de 2021
- País: Brasil
- Instituição resposável pela transferência das informações: Ministério da Saúde
- Unidade responsável pela gestação dos dados: Ministério da Saúde
- Nome do local para transferência:
- Nome da pessoa responável pelo atualização do informe
  preliminar: Regina Tomie Ivata Bernal

## Estrutura geral

A presente análise é realizada pela versão inicial informada pelo Brasil da versão de outubro de 2021 dos eventos adversos grave e não grave.

Número de archivos: 3

Tipo de arquivos: Excel (.xlsx) e csv.

## Descrição e comentários da qualidade:

### Arquivo  1. eapv formulas - 25.10.2021.csv

1.	Resultados do processo de importação dos dados.

O arquivo recebido não apresenta nenhum problema de importação dos dados no programa.

Essa base é composta por 188 variáveis e 143.115 notificações com vacina COVID19 no período de janeiro a outubro de 2021.

Inicialmente observa-se uma base de dados com algum problema de codificação nas variáveis do tipo texto e nas variáveis de datas.



```{r, echo = FALSE, warning = FALSE, message = FALSE}

## Las siguientes 4 líneas son necesarias para configurar las tablas generadas ##

def_cell <- fp_cell(border = fp_border(color = "#000000"))
def_par <- fp_par(text.align = "center")
def_text <- fp_text(color = "#000000", italic = TRUE)
def_text_header <- update(color = "black", def_text, bold = TRUE)

###-------------------- Definiendo el encabezado de la BD -------------------###
###-- Recorte de la extensión de la tabla a exportar (5 primeras variables) -###

paso1 <- head(bd)[,1:5]

###--------------- Definiendo la tabla a exportar y su estilo ---------------### 

ft1 <- flextable(paso1)
ft <- style(ft1, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 1.3) # Esta línea es para establecer el ancho de las celdas
ft
```
2.	Correspondência entre as variáveis disponíveis e o dicionário de dados em relação ao número e especificidade.

A imagem a seguir corresponde ao trecho do formulário com a informações do paciente.

![Foto 1. Página 1 formulario](C:/Users/regin/OPAS/CONTRATO_2021/MS/relatorio/formulario.png)

A imagem a seguir apresenta o trecho do formulário com as informações da vacinação.

![Foto 2. Página 1 formulario](C:/Users/regin/OPAS/CONTRATO_2021/MS/relatorio/vacinacao.png)

3. A estrutura da base de dados sobre vacinação apresenta o histórico do paciente, isto é, para cada notificação pode ter uma ou mais vacinas. 

A Figura a seguir apresenta um exemplo da estrutura da base de dados.


![Foto 3. Página 1 formulario](C:/Users/regin/OPAS/CONTRATO_2021/MS/relatorio/exemplo_notificacao_vacina_eventoadverso.png)

4. Devido a estrutura da base de dados, as análises das vacinas e dos eventos adversos foram realizadas separadamente e documentadas com as suas respectivas informações. 





```{r, echo = FALSE, warning = FALSE, message = FALSE}
names(bd)
```


5.	Concordância entre a quantidade de variáveis informados no metadados e o número de registros presentes na base de dados.

6. Alguns nomes de variáveis estão repetidos, como por exemplo: a data de nascimento do paciente e da mãe estão com o mesmo nome "Data de nascimento". Outro exemplo: CNES Estabelecimento e CNES Estabelecimento_1, o primeiro CNES é referente ao local onde foi realizada a vacinação e o segundo o local de atendimento devido ao evento adverso.

7. Os nomes das variáveis estão representadas por muitos caracteres, sendo necessário o ajuste dos nomes.


```{r, echo = FALSE, warning = FALSE, message = FALSE}


names(bd)[grep('voce_esta_notificando_um_evento_adverso_ou_erro_de_imunizacao_ocorrido_em_uma_crianca_que_foi_exposta_a_vacina_atraves_da_vacinacao_da_mae_durante_a_gestacao_ou_pelo_aleitamento_materno', names(bd))] <- 'MaeAleitamento'

names(bd)[grep('Criança em aleitamento materno, no momento da vacinação?', names(bd))] <- 'criancaEmAleitamento'

names(bd)[grep('Relação imunobiológico ao evento adverso', names(bd))] <- 'relacaoImunobiologico'

names(bd)[grep('CNES Resp. pela admin. do imunobiológico', names(bd))] <- 'cnesAdminImuno'

names(bd)[grep('Mulher amamentando no momento da vacinação', names(bd))] <- 'maeAmamentando'

names(bd)[grep('Intervalo entre a administração e o início da reação / Dia', names(bd))] <- 'intervaloAdminInicioReacaoDia'

names(bd)[grep('Intervalo entre a administração e o início da reação / Hora', names(bd))] <- 'intervaloAdminInicioReacaoHora'

names(bd)[grep('Intervalo entre a administração e o início da reação / Minuto', names(bd))] <- 'cnesAdminImuno'
```




```{r, echo = FALSE, warning = FALSE, message = FALSE}
names(bd)
```

8. Nota-se que, os nomes das variáveis são compostas por uma ou mais palavras  e existe um espaço em branco entre elas. 

A boa prática recomenda evitar o uso de caracteres especiais e espaco em branco no nome da variável.


9. Após o uso da função clean_names() os espaços em branco das variáveis foram substituidos pelo caracter "_".

Dessa maneira facilitará o uso das variáveis nas análises dos dados.



A figura 4 mostra o de-para entre os nomes das variáveis disponíveis na base de dados (primeira coluna) e o EAPV_modelo_Informação.xlsx (segunda coluna).

![Foto 4. Página 1 formulario](C:/Users/regin/OPAS/CONTRATO_2021/MS/relatorio/depara_base_dicionariovariaveis.png)

10. Recomenda-se, se possível, a extração dos dados com os nomes das variáveis disponíveis no arquivo EAPV_modelo_Informação.xlsx.



```{r, echo = FALSE, warning = FALSE, message = FALSE}
bd <- bd %>% clean_names()

names(bd)
```


# Descrição e comentários sobre a qualidade dos dados

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}

plot_intro(bd, title = "Datos faltantes", ggtheme = theme_bw(),
           theme_config = list(legend.position = c("bottom"))) + 
  xlab("Métricas") + ylab("Valor") + ylim(-0.05, 1.05) +
  scale_x_discrete(labels = c("Dados faltantes", "Linhas completas", 
                              "Variaveis vazías", "Variáveis continuas",
                              "Variaveis discretas")) +
  scale_fill_discrete(name = "Dimensão", labels = c("Coluna", "Observação", 
                                                     "Linha"))
```

11. O gráfico mostra:

- 19.1% de variáveis incompletas. 

- 0.0% de linhas incompletas. Isso significa que nenhuma linha está incompleta

- 62.3% de observações faltantes distribuídas nas 188 variáveis.



```{r, echo = FALSE, warning = FALSE, message = FALSE}

###    El comando introduce permite generar una tabla con los descriptivos   ###
###                   relevantes de la base de datos                         ###

paso <- as.data.frame(t(introduce(bd)))

###--------------- Cambiando los nombres del ingles al español --------------###

rownames(paso) <- c("Registros", "Variáveis", "Variáveis discretas",	
                  "Variáveis contínuas", "Variáveis vazias", "Dados faltantes",
                  "Linhas completas", "Observações", "Memoria")
colnames(paso) <- "Valor"
paso$Arg <- rownames(paso) 

paso <- paso %>% select(Arg, Valor)
###---------------------- Generando la tabla en el RMD ----------------------###
ft <- flextable(paso)
ft
```

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}


plot_missing(bd[, 1:8], group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(-20, 10000) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")
```


12. O gráfico mostra o resultado das variáveis:

- Notificação
- Criança em aleitamento materno, no momento da vacinação?
- Data da notificação
- Você está notificando um evento adverso ou erro de imunização ocorrido em uma    
  criança que foi exposta à vacina através da vacinação da mãe durante a gestação ou   pelo aleitamento materno?
- Verssão MedDRA
- Idade Evento
- Município da Notificação
- Estado da Notificação

Nota-se que a maioria das variáveis não apresenta dados faltantes, exceto criança em aleitamento materno com 5.55% de dados faltantes.


## Análise descritiva da notificação de evento adverso ou erro de imunização ocorrido em uma criança que foi exposta à vacina através da vacinação da mãe durante a gestação ou pelo aleitamento materno

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}
plot_frq(bd[,6], title = "Notificação de evento adverso ou erro de imunização ocorrido", sort.frq = "desc", 
         hjust = "bottom", coord.flip = T) + xlab("Resposta") + 
         ylab("Frecuencias") + ylim(0,200000) + theme_bw()
```

- 551 notificações correspondem a exposição de crianças a vacinação durante a gestação ou aleitamento.


```{r , echo = FALSE, warning = FALSE, message = FALSE}
#Selecionar o conjunto de dados
v6 =subset(bd,select=c("data_da_notificacao", "idade_evento", "cnes_resp_pela_admin_do_imunobiologico","mae_aleitamento",
"cpf_da_mae", "idade" ,"data_de_nascimento_1", "raca_cor_1" ,"etnia_1", "cns_1" , "cep_1"  , "logradouro_1", "nome_completo_1" ,"sexo_1" ,"complemento_1" , "numero", "estado_residencia" ,  "municipio_residencia" ,   "telefone_celular_1",         "telefone_de_contato_1"  ,   "e_mail"))                    
                                     


v6_sim <-filter(v6,mae_aleitamento == "Sim") 
#v6_sim$mae_aleitamento = NULL

```


```{r}
names(v6_sim)
```


```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}
plot_missing(v6_sim, group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(0, 800) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")
```




As informações das mães apresentam boa completude dos dados, exceto e-mail e etnia.


```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###

paso <- as.data.frame(table(v6_sim[,6]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Idade da mãe", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```



Temos uma notificação com a informação da data de nascimento e idade da mãe superior a 60 anos.


```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}

###----------------------- Distribución de frecuencias ----------------------###

###--- title: Título del gráfico                                          ---###
###--- sort.frq: Ordenar las frecuencias presentados en el gráfico        ---###
###--- coord.flip: Cambiar las coordenadas del gráfico                    ---###
###--- hjust = "bottom": Posición de las frecuencias en el gráfico        ---###

plot_frq(v6_sim[,8], title = "Raça/Cor", sort.frq = "desc", coord.flip = T, 
         hjust = "bottom") + ylim(0, 600) + xlab("") + ylab("Frequência") +        theme_bw()
```
76 notificações não informação a raça/cor.



```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###

paso <- as.data.frame(table(v6_sim[,17]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("UF", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```
24 UF's com notificações.


```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###

paso <- as.data.frame(table(v6_sim[,14]))

Freq=sum(paso$Freq)
Var1 = "Total"
tab = cbind(Var1,Freq)
tabela = rbind(paso, tab)

big_border = fp_border(color="red", width = 2)
small_border = fp_border(color="gray", width = 1)

###--- Cambiando el nombre de las columnas ---###

colnames(tabela) <- c("Sexo", "Frequências")


ft <- flextable(tabela)

#ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = #"all") 
ft <- border_outer(ft, part="all", border = big_border )
ft <- border_inner_h(ft, part="all", border = small_border )
ft <- border_inner_v(ft, part="all", border = small_border )
ft <- width(ft, width = 3.2)
ft
```

18 notificações com sexo masculino.


```{r}

idade <-filter(v6_sim,idade < 200) 


dispersao = ggplot(idade, aes(x=idade, y=idade_evento)) + geom_point()+
     
  labs(y = "Idade evento", x = "Idade da mãe")
 
plot(dispersao)

```



Era esperado uma correlação entre a idade do evento e a idade da mãe.
Supeita-se que em algumas notificações tenha a informação da idade da pessoa que levou a criança?




```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}


plot_missing(bd[, c(9,10,11,12,13,14,15,16,17,18,20,22,23,24,25,26,27,28,30,31)], group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(-20, 180000) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")


```


13. O gráfico mostra a análise de dados faltantes das variáveis cadastrais do paciete.

Variáveis com menos de 2% de dados faltantes:
- Sexo
- Raça/Cor
- É profissional de saúde?
- Município de residência
- Estado de residência
- Data de nascimento do paciente
- Tem CPF?
- Logradouro
- Bairro de residência
- Número (ou SN para Sem Número)
- Profissional de Segurança

Variáveis entre 10% e 11% de dados faltantes:
- Telefone celular
- Número do CPF

Variáveis entre 56% e 71% de dados faltantes:
- Complemento do endereço
- Telefone de contato

Variáveis acima de 88% de dados faltantes:
- Nome completo da mãe
- Cartão Nacional de Saúde (CNS)
- 


Vale ressaltar que a variável Complemento do endereço é importante para condominios e apartamentos. Isso pode explicar o 51.5% das notificações sem essa infomação.  

## Análise descritiva Estrangeiro

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}


plot_missing(bd[, c(19,21,29,32)], group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(-20, 150000) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")


```

90% das notificações não preencheram a informação Estrangeiro.


## Análise descritiva da notificação de evento adverso ou erro de imunização ocorrido em uma criança que foi exposta à vacina através da vacinação da mãe durante a gestação ou pelo aleitamento materno

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}
plot_frq(bd[,21], title = "Estrangeiro", sort.frq = "desc", 
         hjust = "bottom", coord.flip = T) + xlab("Resposta") + 
         ylab("Frequência") + ylim(0,20000) + theme_bw()
```

Das notificações que preencheram a informação Estrangeiro, somente 8 casos eram estrangeiros.

ft <- add_header_row(ft,
  colwidths = c(4, 2),
  values = c("Air quality", "Time")
  
  

```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###

paso <- as.data.frame(table(bd[,32]))

str(paso)


Freq=sum(paso$Freq)
Var1 = "Total"
tab = cbind(Var1,Freq)
tabela = rbind(paso, tab)


###--- Cambiando el nombre de las columnas ---###
colnames(tabela) <- c("Etnia", "Frequências")


big_border = fp_border(color="red", width = 2)
small_border = fp_border(color="gray", width = 1)


ft <- flextable(tabela)

#ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = #"all") 
ft <- border_outer(ft, part="all", border = big_border )
ft <- border_inner_h(ft, part="all", border = small_border )
ft <- border_inner_v(ft, part="all", border = small_border )
ft <- width(ft, width = 3.2)
ft
```



### Análise Comunidade provo tradicional




```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###

paso <- as.data.frame(table(bd[,33]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Comunidade/Povo Tradicional?", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```
1.076 notificações são de comunidade/povo tradicional.


```{r, echo = FALSE, warning = FALSE, message = FALSE}

#Selecionar o conjunto de dados
v29 =subset(bd,select=c("data_da_notificacao", "idade_evento", "cnes_resp_pela_admin_do_imunobiologico","comunidade_povo_tradicional" ,"comunidade_povo_tradicional_2"))                    
                                     

v29_sim <-filter(v29,comunidade_povo_tradicional == "Sim") 
#v29_sim$mae_aleitamento = NULL

```




```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}


plot_missing(v29_sim, group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(-20, 1800) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")
```
Em 28,16% das notificações não informaram o CNES responsável pela adiministração do imunológico.



```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v29_sim[,5]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Comunidade/Povo Tradicional?", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```

### Análise sobre viagem nos últimos 15 dias




```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(bd[,98]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Viajou nos 15 dias anteriores ao inicio do evento?", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```

### Análise de gestantes



```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}


plot_missing(bd[, c(76,77,78)], group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(0, 150000) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")
```



```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(bd[,76]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Mãe Gestante no momento da vacinação?", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```
                                                                                                                                                     
 [77]                                                                                                                                                
 [78]  

```{r , echo = FALSE, warning = FALSE, message = FALSE}

#Selecionar o conjunto de dados
v76 =subset(bd,select=c("data_da_notificacao", "idade_evento", "cnes_resp_pela_admin_do_imunobiologico","sexo", "mae_gestante_no_momento_da_vacinacao" ,
                       "mae_aleitamento","cpf_da_mae", "idade", "mes_de_gestacao_no_momento_da_vacinacao_1" , "mae_amamentando_no_momento_da_vacinacao"  ))                    
                                     


v76_sim <-filter(v76,mae_gestante_no_momento_da_vacinacao == "Sim") 
#v6_sim$mae_aleitamento = NULL

```


```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v76_sim[,2]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Mês de gestação no momento da vacinação?", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```


### Análise da questão: Viajou nos últimos 15 dias

```{r , echo = FALSE, warning = FALSE, message = FALSE}

#Selecionar o conjunto de dados
v98 =subset(bd,select=c("data_da_notificacao", "idade_evento", "cnes_resp_pela_admin_do_imunobiologico",
"viajou_nos_15_dias_anteriores_ao_inicio_do_evento",                              "data_de_inicio_2", "data_termino","local" , "pais" ,                           "estado"   ,  "municipio",                                                     "medicamento_em_uso_anterior_ou_durante_a_vacinacao" ,                          "nome_do_medicamento" ,                                                         "relacao_do_medicamento_ao_evento_adverso" ,                                    "comentario_sobre_o_uso"  ,                                                    "houve_atendimento_medico",                                                      "tipo_de_atendimento" ,                                                         "nome_do_estabelecimento_de_saude" ,                                            "cnes_estabelecimento_de_saude" ,                                               "estado_1",                                                                     "data_da_admissao",                                                             "municipio_2",                                                                  "data_da_alta" ,                                                                "observacoes_complementares",                                                   "nome_do_exame",                                                                "resultado_do_exame" ,                                                          "data_da_realizacao_do_exame" ,                                                 "diagnostico_cid_10",                                                           "cnes_estabelecimento_1" ,                                                      "telefone_responsavel_1",                                                       "cpf_responsavel_1",                                                            "nome_do_profissional_1" ,                                                      "e_mail_responsavel_2" ,                                                        "data_da_investigacao" ,                                                        "ocupacao_do_profissional_1"))                    
                                     


v98_sim <-filter(v98,viajou_nos_15_dias_anteriores_ao_inicio_do_evento == "Sim") 

```




```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}


plot_missing(v98_sim[, 1:16], group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(-20, 1800) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")
```



```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v98_sim[,8]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("País", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```



```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v98_sim[,7]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Local", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```





```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v98_sim[,9]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Estado", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```




```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v98_sim[,16]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Tipo de atendimento", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```




```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v98_sim[,23]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Observações", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```




```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.width = 6}


plot_missing(v98_sim[, 17:34], group = list("1-Ideal" = 0.05,
                                        "2-Adequado" = 0.4,
                                        "3-Ruim" = 0.8,
                                        "4-Excluir" = 1),
    theme_config = list(legend.position = c("bottom")),
    ggtheme = theme_bw()) + ylim(-20, 1800) + xlab("Variáveis") + 
  ylab("Faltantes") + scale_fill_discrete(name = "Límite")
```


17. O gráfico mostra a análise dos dados faltantes do responsável pela notificacação.

As variáveis apresentam menos que 5% de dados faltantes:
- Ocupação do profissional-
- Data da investigação
- CPF responsável
- Nome do profissional
- CNES do estabelecimento

As variáveis apresentam entre >5% e 40% de dados faltantes:
- E-mail do responsável
- Telefone do responsável pela notificação

As variáveis apresentam entre 16% e 28% de dados faltantes:
- Descrição do caso
- E-mail do responsável pela notificação

As variáveis apresentam 52% de dados faltantes:
- Data do recebimento da notificação
- Descricao detalhada do Evento Adverso




```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v98_sim[,20]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Data de admissão", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```







```{r, echo = FALSE, warning = FALSE, message = FALSE}
plot_missing(bd[,129:143])
```
22. O gráfico mostra a análise das variáveis de encerramento do Município.

As variáveis apresentam acima de 69% de dados faltantes.


```{r, echo = FALSE, warning = FALSE, message = FALSE}
plot_missing(bd[,144:158])
```
23. O gráfico mostra a análise das variáveis de encerramento do Estado.

As variáveis apresentam acima de 70% de dados faltantes.




```{r, echo = FALSE, warning = FALSE, message = FALSE}
plot_missing(bd[,159:173])
```

24. O gráfico mostra a análise das variáveis de encerramento Federal.

As variáveis apresentam acima de 100% de dados faltantes.

```{r, echo = FALSE, warning = FALSE, message = FALSE}
plot_missing(bd[,174:188])
```


25. O gráfico mostra a análise das variáveis de encerramento do Comitê Interinstitucional de Farmacovigilância de Vacinas e outros Imunobiológicos 
(CIFAVI).

As variáveis apresentam acima de 100% de dados faltantes.


### Análise da qualidade dos dados dos valor do atributo (variável)

#### Idade do evento
```{r, echo = FALSE, warning = FALSE, message = FALSE}
summary(bd$idade_evento)
```



```{r , echo = FALSE, warning = FALSE, message = FALSE}
#Selecionar o conjunto de dados
v4 =subset(bd,select=c("data_da_notificacao", "idade_evento", "cnes_resp_pela_admin_do_imunobiologico","data_de_nascimento"))                    
                                 
v4$data_erro = ifelse(v4$idade_evento < 0 | v4$idade_evento > 120, "Sim", "Não")

v4_sim <-filter(v4,idade_evento < 0 | idade_evento > 120) 

```




```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v4[,5]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Data com erro", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```




```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v4_sim[,4]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Data de nascimento", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```





```{r, echo = FALSE, warning = FALSE, message = FALSE}

###--- Seleccionando los registros anómalos ---###
9
paso <- as.data.frame(table(v4_sim[,1]))

###--- Cambiando el nombre de las columnas ---###

colnames(paso) <- c("Data da notificação", "Frequências")

ft <- flextable(paso)
ft <- style(ft, pr_c = def_cell, pr_p = def_par, pr_t = def_text, part = "all")  
ft <- width(ft, width = 3.2)
ft
```



26. A análise descritiva da Idade apresenta o valor negativo negativo e a máxima igual a 379 anos. Esses valores não respeitam o domínio dda variável.


```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(stringr)
### Extração do ano de nascimento ###

# seleção das variáveis quantitativas
df=subset(bd,select=c(numero_da_notificacao,data_da_notificacao,data_de_nascimento,idade_evento,
                      mae_aleitamento))
df$ano_nasc <- str_sub(df$data_de_nascimento, -4)
df$ano_not <- str_sub(df$data_da_notificacao, -4)
df$ano_nasc = as.integer(df$ano_nasc)
df$ano_not = as.integer(df$ano_not)
df$idade_calc = df$ano_not - df$ano_nasc

#Selecionar o conjunto de dados
df_idadeneg <-filter(df,idade_evento < 0) 
df_idadeout <-filter(df,idade_evento > 120) 
df_idadezero <-filter(df,idade_evento == 0)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
print(df_idadezero)

```



```{r, echo = FALSE, warning = FALSE, message = FALSE}
#Distribuição de frequência para variável mãe
freq_abs=table(df_idadezero$ano_nasc) ##frequencia absoluta
freq_rel=freq_abs/sum(freq_abs) ##frequencia relativa
freq_rel=100*freq_rel ##fp=frequencia percentual
dist=cbind(freq_abs,freq_rel) ##distribuicao de frequências
dist
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
#Distribuição de frequência para variável mãe
freq_abs=table(df_idadezero$mae_aleitamento) ##frequencia absoluta
freq_rel=freq_abs/sum(freq_abs) ##frequencia relativa
freq_rel=100*freq_rel ##fp=frequencia percentual
dist=cbind(freq_abs,freq_rel) ##distribuicao de frequências
dist
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
print(df_idadeneg)

```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
print(df_idadeout)

```

27. A idade negativa (N=12) é devido ao erro na data da notificação e a idade maior ou igual a 120 anos (N=38) é devido ao erro na data de nascimento. Dos 1937 pacientes com idade igual a zero (0), 604 são erros.


28. A variável nome do paciente apresenta problema de sintaxe. Há necessidade de padronizar o nome e corrigir a duplicade.

29. Precisa validar a data da notificação e data de nascimento, devido aos problemas identificados no item 27).


### Conclusões


A base de dados apresenta alguns problemas de qualidade dos dados, relacionados a seguir.



1) Problemas relacionados ao valor do atributo (variável), sendo:

- Dado faltante: Informação obrigatória e não informada.

- Violação de sintaxe: O valor não respeita a sintaxe estabelecida para o atributo. Por exemplo, o atributo “Nome completo” contém o valor ANA M. SILVA ao invés de ANA MARIA SILVA. Outro exemplo seria o nome do fabricante da vacina. Outro exemplo: nome do fabricante, dose e lote.

- Erro ortográfico: O valor contém um erro ortográfico acidental (exemplo: o atributo “Nome completo” contém o valor “AAN MARIA SILVA” ao invés de “ANA MARIA SILVA”.

-	Violação de domínio: O valor não faz parte do conjunto de valores válidos do atributo. Por exemplo, idade negativa ou idade maior que 200 anos.


2) Poblemas de qualidade dos dados relacionados às diferentes instâncias de valores de um atributo (variável), sendo:

-	Violação de unicidade: Um atributo que deveria ser de valor único com valores iguais em mais de um paciente. Por exemplo, dois pacientes com mesmo CPF.

- Problemas de qualidade dos dados relacionados às tuplas, sendo:

-	Violação de restrição de integridade: Quando uma restrição de integridade ao nível dos valores dos atributos da tupla não é respeitada. Por exemplo: o atributo Dose com valores: <1ª Dose, 2ª Dose, 1ª Dose> ao invés de <1ª Dose, 2ª Dose>.


3) Problemas de qualidade dos dados relacionados à relação entre os dados, sendo:

-	Violação de dependência funcional: Uma dependência funcional envolvendo dois ou mais atributos é violada pelos valores de uma tupla. Por exemplo, valores dos atributos UF e CEP incompatíveis como: (São Paulo, ‘04444-000’) e (Campinas, ‘04444-000’). Outro exemplo: Mês de gestação no momento da vacinação depende se a é  Mãe Gestante no momento da vacinação.

-	Tuplas duplicadas: Registros duplicados. Por exemplo, na presença de várias ocorrências de uma mesma notificação em um mesmo dia. Outro exemplo: vacina duplicada. 



A quantificação das dimensões críticas da qualidade de dados permite a identificação dos problemas relacionados à qualidade de dados, a documentação das causas dos problemas das variáveis que não estão sob controle e a priorização da correção destes problemas.



